<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{mso-style-link:"Footnote Text Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	color:#4F81BD;
	font-weight:bold;}
span.MsoFootnoteReference
	{vertical-align:super;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Title Char";
	margin:0cm;
	margin-bottom:.0001pt;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Title Char";
	margin:0cm;
	margin-bottom:.0001pt;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Title Char";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{mso-style-link:"Subtitle Char";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Cambria",serif;
	color:#4F81BD;
	letter-spacing:.75pt;
	font-style:italic;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p
	{margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-weight:bold;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma",sans-serif;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
span.SubtitleChar
	{mso-style-name:"Subtitle Char";
	mso-style-link:Subtitle;
	font-family:"Cambria",serif;
	color:#4F81BD;
	letter-spacing:.75pt;
	font-style:italic;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.FootnoteTextChar
	{mso-style-name:"Footnote Text Char";
	mso-style-link:"Footnote Text";}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 53.85pt 72.0pt 53.85pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=PT link=blue vlink=purple>

<div class=WordSection1>

<p class=MsoNormal align=center style='text-align:center'><img width=354
height=117 id="Picture 131" src="exemplo_files/image006.jpg"></p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<div style='border:none;border-bottom:solid #4F81BD 1.0pt;padding:0cm 0cm 4.0pt 0cm'>

<p class=MsoTitle><span lang=EN-US>Formal Modeling of a Vending Machine in
VDM++</span></p>

</div>

<p class=MsoSubtitle><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoSubtitle align=center style='text-align:center'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoSubtitle>Mestrado Integrado em Engenharia Informática e Computação</p>

<p class=MsoSubtitle>Métodos Formais em Engenharia de Software</p>

<p class=MsoNormal><i><span style='font-size:12.0pt;line-height:115%;
font-family:"Cambria",serif;color:#4F81BD;letter-spacing:.75pt'>Pascoal Faria</span></i></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoTocHeading><span lang=EN-US>Contents</span></p>

<p class=MsoToc1><a href="#_Toc435377798"><span lang=EN-US>1. Informal system
description and list of requirements</span><span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></p>

<p class=MsoToc2><a href="#_Toc435377799"><span lang=EN-US>1.1 Informal system
description</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></p>

<p class=MsoToc2><a href="#_Toc435377800"><span lang=EN-US>1.2 List of
requirements</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></p>

<p class=MsoToc1><a href="#_Toc435377801">2. Visual UML model <span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc2><a href="#_Toc435377802">2.1 Use case model <span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc2><a href="#_Toc435377803">2.2 Class model  <span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>6</span></a></p>

<p class=MsoToc1><a href="#_Toc435377804">3. Formal VDM++ model<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></p>

<p class=MsoToc2><a href="#_Toc435377805">3.1 Class MoneyUtils <span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></p>

<p class=MsoToc2><a href="#_Toc435377806">3.2 Class Product<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>8</span></a></p>

<p class=MsoToc2><a href="#_Toc435377807">3.3 Class VendingMachine<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>9</span></a></p>

<p class=MsoToc1><a href="#_Toc435377808">4. Model validation<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc2><a href="#_Toc435377809">4.1 Class MyTestCase<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc2><a href="#_Toc435377810">4.2 Class TestVendingMachine<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc1><a href="#_Toc435377811"><span lang=EN-US>5. Model
verification</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>16</span></a></p>

<p class=MsoToc2><a href="#_Toc435377812"><span lang=EN-US>5.1 Example of
domain verification</span><span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>16</span></a></p>

<p class=MsoToc2><a href="#_Toc435377813"><span lang=EN-US>5.2 Example of
invariant verification</span><span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>16</span></a></p>

<p class=MsoToc1><a href="#_Toc435377814"><span lang=EN-US>6. Conclusions</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></p>

<p class=MsoToc1><a href="#_Toc435377815">7. References<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:115%;
font-family:"Cambria",serif;color:#365F91'>&nbsp;</span></b></p>

<h1><a name="_Toc435377798"><span lang=EN-US>1. Informal system description and
list of requirements</span></a></h1>

<h2><a name="_Toc435377799"><span lang=EN-US>1.1 Informal system description</span></a></h2>

<p class=MsoNormal><img width=632 height=274 src="exemplo_files/image007.png"></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2><a name="_Toc435377800"><span lang=EN-US>1.2 List of requirements</span></a></h2>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='margin-left:5.4pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Id</span></b></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Priority</span></b></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>R1</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Mandatory</span></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>The factory operator can configure the products at
  sale (with names and prices) and the maintenance code. </span></p>
  </td>
 </tr>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>R2</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Mandatory</span></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>The maintenance operator can load/extract products
  and coins to/from the machine, using the maintenance code to unlock the door.</span></p>
  </td>
 </tr>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>R3</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Mandatory</span></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>The end user (buyer) can buy products, by entering
  coins and selecting the desired product.</span></p>
  </td>
 </tr>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>R4</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Mandatory</span></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>The machine should be able to give change, in case
  the user inserts coins in excess.</span></p>
  </td>
 </tr>
 <tr>
  <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>R5</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Mandatory</span></p>
  </td>
  <td width=520 valign=top style='width:389.65pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>The end user (buyer) should be able to cancel a
  purchase operation and receive back the amount inserted.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>These requirements are directly translated
onto use cases as shown next.</span></p>

<span lang=EN-US style='font-size:11.0pt;line-height:115%;font-family:"Calibri",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><b><span lang=EN-US style='font-size:14.0pt;line-height:
115%;font-family:"Cambria",serif;color:#365F91'>&nbsp;</span></b></p>

<h1><a name="_Toc435377801"><span lang=EN-US>2. Visual UML model </span></a><a
href="#_ftn1" name="_ftnref1" title=""><span class=MsoFootnoteReference><span
class=MsoFootnoteReference><b><span style='font-size:14.0pt;line-height:115%;
font-family:"Cambria",serif;color:#365F91'>[1]</span></b></span></span></a></h1>

<h2><a name="_Toc435377802"><span lang=EN-US>2.1 Use case model </span></a><a
href="#_ftn2" name="_ftnref2" title=""><span class=MsoFootnoteReference><span
class=MsoFootnoteReference><b><span style='font-size:13.0pt;line-height:115%;
font-family:"Cambria",serif;color:#4F81BD'>[2]</span></b></span></span></a></h2>

<p class=MsoNormal align=center style='text-align:center'><img width=523
height=530 id="Picture 135" src="exemplo_files/image008.jpg"></p>

<p class=MsoNormal><span lang=EN-US>The major use case scenarios (to be used
later as test scenarios) are described next. </span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Scenario</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Configure machine </span></b></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Normal scenario for configuring (at the factory) the
  products at sale (with name and price) and the maintenance code.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Pre-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The product names are unique. <i>(input)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Post-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The products names and prices are configured as
  intended. <i>(final system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The maintenance code is configured as intended. <i>(final
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The stock of coins is empty. <i>(final system
  state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. The stock of products is empty. <i>(final system
  state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>5. The machine is in the idle state. <i>(final
  system state)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Steps</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>(unspecified)</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Exceptions </span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>(unspecified)</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Scenario</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Load stock</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Normal scenario for loading (adding) products and
  setting (adding/removing) the stock of coins in a vending machine.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Pre-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The machine is initially idle. <i>(initial system
  state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The operator knows the code for unlocking the
  door. <i>(input)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3.  The products to load are among the ones
  configured in the machine. <i>(input)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Post-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The items were added to the stock of products. <i>(final
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The stock of coins was set to the intended one. <i>(final
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The machine is idle again. <i>(final system
  state)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Steps</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. Unlock and open the machine door.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. Set the stock of coins and add the products, by
  any order.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. Close the machine door.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Exceptions </span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>(none)</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Scenario</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Buy product</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Normal purchase scenario in a vending machine.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Pre-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The machine is initially idle (ready). <i>(initial
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The machine has the product in stock. <i>(initial
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The buyer has enough coins. <i>(input)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. If needed, the machine has coins in stock to give
  change. <i>(initial system state)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Post-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer received the product. <i>(output)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The buyer received the change, if needed. <i>(output)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The stock of the product is updated in the
  machine. <i>(final system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. The stock of coins is updated in the machine. <i>(final
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>5. The machine is idle (ready) again. <i>(final
  system state)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Steps</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer inserts the coins. </span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The machine displays the money inserted (credit).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The buyer selects the product.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. The machine delivers the product and the change,
  if needed.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>5. The buyer picks the product and the change, if
  existent</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Exceptions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer cancels the purchase (alternative to
  step 3) - see scenario description next.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The product is out of stock (step 4).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The machine cannot make change (step 4).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The buyer forgets to pick the product (step 5).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. The buyer forgets to pick the change (step 5).</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Scenario</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Cancel purchase</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Alternative purchase scenario in a vending machine,
  in which the user cancels.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Pre-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The machine is initially idle (ready). <i>(initial
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The buyer has coins to insert. <i>(input)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Post-conditions</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer received back the amount inserted (same
  or equivalent coins). <i>(output)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The amount of money is unchanged in the machine. <i>(final
  system state)</i></span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The machine is idle again. <i>(final system
  state)</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Steps</span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer inserts the coins. </span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>2. The machine displays the money inserted (credit).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>3. The buyer cancels the operation.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>4. The machine returns back the coins inserted.</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>5. The buyer picks the coins.</span></p>
  </td>
 </tr>
 <tr>
  <td width=111 valign=top style='width:83.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><b><span lang=EN-US>Exceptions </span></b></p>
  </td>
  <td width=548 valign=top style='width:411.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>1. The buyer forgets to pick the coins (step 5).</span></p>
  </td>
 </tr>
</table>

<h2><a name="_Toc435377803">2.2 Class model </a><a href="#_ftn3" name="_ftnref3"
title=""><span class=MsoFootnoteReference><span class=MsoFootnoteReference><b><span
style='font-size:13.0pt;line-height:115%;font-family:"Cambria",serif;
color:#4F81BD'>[3]</span></b></span></span></a> <a href="#_ftn4" name="_ftnref4"
title=""><span class=MsoFootnoteReference><span class=MsoFootnoteReference><b><span
style='font-size:13.0pt;line-height:115%;font-family:"Cambria",serif;
color:#4F81BD'>[4]</span></b></span></span></a></h2>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><img
width=626 height=408 id="Picture 1" src="exemplo_files/image009.jpg"><img
width=631 height=286 id="Picture 134" src="exemplo_files/image010.jpg"></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center;line-height:normal'><b><span lang=EN-US>Class</span></b></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center;line-height:normal'><b><span lang=EN-US>Description</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-family:Consolas'>MoneyUtils</span></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Defines utility types and functions to work with
  bags (multisets) of coins.</span></p>
  </td>
 </tr>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-family:Consolas'>Product</span></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Defines a product at sale in a vending machine.</span></p>
  </td>
 </tr>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-family:Consolas'>VendingMachine</span></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Core model; defines the state variables and operations
  available to the users.</span></p>
  </td>
 </tr>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-family:Consolas'>MyTestCase</span></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Superclass for test classes; defines </span><span
  lang=EN-US style='font-family:Consolas'>assertEquals</span><span lang=EN-US>
  and </span><span lang=EN-US style='font-family:Consolas'>assertTrue</span><span
  lang=EN-US>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=160 valign=top style='width:105.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-family:Consolas'>TestVendingMachine</span></p>
  </td>
  <td width=519 valign=top style='width:389.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US>Defines the test/usage scenarios and test cases for
  the vending machine.</span></p>
  </td>
 </tr>
</table>

<h1><a name="_Toc435377804"><span lang=EN-US>3. Formal VDM++ model</span></a><span
lang=EN-US> </span></h1>

<h2><a name="_Toc435377805"><span lang=EN-US>3.1 Class MoneyUtils </span></a><a
href="#_ftn5" name="_ftnref5" title=""><span class=MsoFootnoteReference><span
class=MsoFootnoteReference><b><span style='font-size:13.0pt;line-height:115%;
font-family:"Cambria",serif;color:#4F81BD'>[5]</span></b></span></span></a></h2>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>class</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> MoneyUtils</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Contains utility types and functions to
work with bags (multisets) of coins. </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Illustrates the definition of auxiliary
data types, as well as the definition </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  of a functionality (extract/makeChange)
at different levels of abstraction.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  JPF, FEUP, MFES, 2014/15.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>values</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- possible coin values, in cents of
euros</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
CoinValues : </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>set</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>of</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nat1</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> = <span
style='background:lime'>{1</span>, <span style='background:lime'>2</span>, <span
style='background:lime'>5</span>, <span style='background:lime'>10</span>, <span
style='background:lime'>20</span>, <span style='background:lime'>50</span>, <span
style='background:lime'>100</span>, <span style='background:lime'>200</span>};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>types</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> Coin = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nat1</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>inv</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> c == <span
style='background:lime'>c</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>CoinValues</span>;     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
BagOfCoins = </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>map</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> Coin </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nat1</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>; </span><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- maps
coin values to quantities</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>functions</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Computes the total amount in a
bag of coins</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> sum:
BagOfCoins -&gt; </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   sum(b) == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>b</span> <span style='background:lime'>=</span> <span
style='background:lime'>{</span>|-&gt;} </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>0</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>let</span> c </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>b</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>b</span>(<span style='background:lime'>c</span>) <span
style='background:lime'>*</span> <span style='background:lime'>c</span> <span
style='background:lime'>+</span> <span style='background:lime'>sum</span>(<span
style='background:lime'>{c</span>} <span style='background:lime'>&lt;-:</span> <span
style='background:lime'>b</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Adds a coin to a bag of coins and
returns the new bag</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> add: Coin
* BagOfCoins -&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   add(coin, bag) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>coin</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag</span> <span style='background:lime'>++</span> { <span
style='background:lime'>coin</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>bag</span>(<span style='background:lime'>coin</span>)
<span style='background:lime'>+</span> <span style='background:lime'>1</span>} </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag</span> <span style='background:lime'>munion</span>
{<span style='background:lime'>coin</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>1</span>};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Removes a coin from a bag of
coins and returns the new bag</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> remove:
Coin * BagOfCoins -&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   remove(coin, bag) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>bag</span>(<span style='background:lime'>coin</span>) <span
style='background:lime'>=</span> <span style='background:lime'>1</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{coin</span>} <span style='background:lime'>&lt;-:</span>
<span style='background:lime'>bag</span> </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag</span> <span style='background:lime'>++</span> {<span
style='background:lime'>coin</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>bag</span>(<span style='background:lime'>coin</span>)
<span style='background:lime'>-</span> <span style='background:lime'>1</span>} </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>coin</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Adds two bags of coins and
returns the new bag</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> addAll:
BagOfCoins * BagOfCoins -&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   addAll(bag1, bag2) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>{</span> <span
style='background:lime'>c</span> <span style='background:lime'>|-&gt;</span> (<span
style='background:lime'>if</span> <span style='background:lime'>c</span> <span
style='background:lime'>in</span></span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag1</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag1</span>(<span style='background:lime'>c</span>) </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>0</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>             <span style='background:lime'>+</span>
(<span style='background:lime'>if</span> <span style='background:lime'>c</span>
<span style='background:lime'>in</span></span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag2</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag2</span>(<span style='background:lime'>c</span>) </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>0</span>) |</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>             c </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag1</span> <span
style='background:lime'>union</span> <span style='background:lime'>dom</span> <span
style='background:lime'>bag2</span>};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Subtracts the first bag of coins
from the second one, and returns the result</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
removeAll: BagOfCoins * BagOfCoins -&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   removeAll(bag1, bag2) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>{c</span> <span
style='background:lime'>|-&gt;</span> <span style='background:lime'>bag2</span>(<span
style='background:lime'>c</span>) <span style='background:lime'>-</span> (<span
style='background:lime'>if</span> <span style='background:lime'>c</span> <span
style='background:lime'>in</span></span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag1</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>bag1</span>(<span style='background:lime'>c</span>) </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>0</span>) |</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           c </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag2</span>
&amp; <span style='background:lime'>not</span> (<span style='background:lime'>c</span>
<span style='background:lime'>in</span></span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag1</span> <span
style='background:lime'>and</span> <span style='background:lime'>bag1</span>(<span
style='background:lime'>c</span>) <span style='background:lime'>=</span> <span
style='background:lime'>bag2</span>(<span style='background:lime'>c</span>))}</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>isSubBag</span>(<span style='background:lime'>bag1</span>,
<span style='background:lime'>bag2</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Checks if the first bag of coins
is a subbag of the second one</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> isSubBag:
BagOfCoins * BagOfCoins -&gt; </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>bool</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   isSubBag(b1, b2) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>dom</span>
<span style='background:lime'>b1</span> <span style='background:lime'>subset</span>
<span style='background:lime'>dom</span> <span style='background:lime'>b2</span>
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>and</span>
<span style='background:lime'>forall</span> c </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>b1</span>
&amp; <span style='background:lime'>b1</span>(<span style='background:lime'>c</span>)
<span style='background:lime'>&lt;=</span> <span style='background:lime'>b2</span>(<span
style='background:lime'>c</span>); </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   /*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- Extracts (computes) a subbag that
makes up a given amount.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  -- Version 1, highest possible level of
abstraction, following definition (not used).</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  public extract1: BagOfCoins * nat -&gt;
BagOfCoins</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  extract1(bag, amount) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>    let e in set allSubBags(bag) be st
sum(e) = amount in e</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  pre canExtract1(bag, amount);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- Checks if is is possible to make a
given amount from a bag.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- Version 1, highest possible level of
abstraction, following definition (not used).</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   public canExtract1: BagOfCoins * nat
-&gt; bool</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   canExtract1(bag, amount) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>     exists e in set allSubBags(bag) &amp;
sum(e) = amount;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- Auxiliary function for version 1, that
generates a set with all possible subbags </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- of a a bag of coins (not used).</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   private allSubBags: BagOfCoins -&gt; set
of BagOfCoins</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   allSubBags(bag) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>     if bag = {|-&gt;} then {{|-&gt;}}</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>     else let c in set dom bag in</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>            dunion {{s, add(c, s)} | s in
set allSubBags(remove(c, bag))};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   */</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>             </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Extracts (computes) a subbag that
makes up a given amount.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Version 2, less abstract,
following a greedy algorithm with backtracing.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Returns nil if there is no
solution.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> extract:
BagOfCoins * </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> -&gt; [BagOfCoins] </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   extract(bag, amount) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>extractAux</span>(<span
style='background:lime'>bag</span>, <span style='background:lime'>amount</span>,
<span style='background:lime'>amount</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Auxiliary function that does the
work of 'extract'.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- The third argument is the maximum
value of coins to use.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=FR style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>private</span></b><span lang=FR
style='font-size:10.0pt;font-family:Consolas;color:black'> extractAux:
BagOfCoins * </span><b><span lang=FR style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>nat</span></b><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'> * </span><b><span lang=FR style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nat</span></b><span lang=FR
style='font-size:10.0pt;font-family:Consolas;color:black'> -&gt; [BagOfCoins] </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>   </span><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>extractAux(bag, amount, maxCoin) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>amount</span> <span style='background:lime'>=</span> <span
style='background:lime'>0</span> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{</span>|-&gt;}    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>let</span> coins = <span style='background:lime'>reverse</span>
<span style='background:lime'>[c</span> | c </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>bag</span>
&amp; <span style='background:lime'>c</span> <span style='background:lime'>&lt;=</span>
<span style='background:lime'>maxCoin</span> <span style='background:lime'>and</span>
<span style='background:lime'>c</span> <span style='background:lime'>&lt;=</span>
<span style='background:lime'>amount</span>] </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>             <span style='background:lime'>if</span>
<span style='background:lime'>coins</span> <span style='background:lime'>=</span>
<span style='background:lime'>[</span>] </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>nil</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>              </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>let</span> c = <span style='background:lime'>hd</span> <span
style='background:lime'>coins</span>,</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                       remaining = <span
style='background:lime'>extractAux</span>(<span style='background:lime'>remove</span>(<span
style='background:lime'>c</span>, <span style='background:lime'>bag</span>), <span
style='background:lime'>amount</span> <span style='background:lime'>-</span> <span
style='background:lime'>c</span>, <span style='background:lime'>c</span>) </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                   </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>if</span> <span style='background:lime'>remaining</span>
<span style='background:lime'>&lt;&gt;</span> <span style='background:lime'>nil</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>then</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>add</span>(<span
style='background:lime'>c</span>, <span style='background:lime'>remaining</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                     </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>extractAux</span>(<span style='background:lime'>bag</span>,
<span style='background:lime'>amount</span>, <span style='background:lime'>c</span>
<span style='background:lime'>-</span> <span style='background:lime'>1</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Checks if is is possible to make
a given amount from a bag.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Version 2, less abstract.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
canExtract: BagOfCoins * </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nat</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> -&gt; </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>bool</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  canExtract(bag, amount) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>extract</span>(<span
style='background:lime'>bag</span>, <span style='background:lime'>amount</span>)
<span style='background:lime'>&lt;&gt;</span> <span style='background:lime'>nil</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:10.0pt;line-height:
115%;font-family:Consolas;color:#7F0055'>end</span></b><span lang=EN-US
style='font-size:10.0pt;line-height:115%;font-family:Consolas;color:black'>
MoneyUtils</span></p>

<h2><a name="_Toc435377806"><span lang=EN-US>3.2 Class Product</span></a></h2>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>class</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> Product</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Defines a product at sale in a vending
machine.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  JPF, FEUP, MFES, 2014/15.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>types</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductName = </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>seq1</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>of</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>char</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductPrice = </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat1</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>; </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- in cents</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>instance variables</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/* <b>Tip</b>: variables are
declared public to facilitate queries */</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> name:
ProductName;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> price:
ProductPrice;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
quantityInStock : </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nat</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> := <span
style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>operations</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> Product </span><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas'>: ProductName <span
style='color:black'>* </span>ProductPrice<span style='color:black'> ==&gt;
Product</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   Product(nm, pr) == <span style='background:
lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>name</span>
:= <span style='background:lime'>nm</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>price</span>
:= <span style='background:lime'>pr</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>return</span>
<span style='background:lime'>self</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
removeFromStock: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> ==&gt; () </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   removeFromStock(qty) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>quantityInStock</span>
:= <span style='background:lime'>quantityInStock</span> <span style='background:
lime'>-</span> <span style='background:lime'>qty</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>qty</span> <span style='background:lime'>&lt;=</span> <span
style='background:lime'>quantityInStock</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
addToStock: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> ==&gt; () </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   addToStock(qty) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>quantityInStock</span>
:= <span style='background:lime'>quantityInStock</span> <span style='background:
lime'>+</span> <span style='background:lime'>qty</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>end</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> Product</span><span
lang=EN-US style='font-size:10.0pt'> </span></p>

<h2><a name="_Toc435377807"><span lang=EN-US>3.3 Class VendingMachine</span></a></h2>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>class</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> VendingMachine</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Contains the core model of the vending
machine.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Defines the state variables and
operations available to the users.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Among other features, illustrates the
usage of 'atomic'.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  JPF, FEUP, MFES, 2014/15.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>types</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
BagOfCoins = MoneyUtils`BagOfCoins;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductName = Product`ProductName;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductPrice = Product`ProductPrice;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> Status=</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;OnFactory&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> | </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;OnMaintenance&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> | </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Idle&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> | </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;EnteringCoins&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> | </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> Password
= </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>seq</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>of</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>char</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>instance variables</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/* Tip: variables declared public to
facilitate queries */</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Items observable by buyer (in
display, selection buttons, and pickup slots):</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> products:
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>map</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> ProductName </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> Product
:= <span style='background:lime'>{</span> |-&gt; };</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> status :
Status := <span style='background:lime'>&lt;OnFactory&gt;</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
amountInserted: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> := <span style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
changeToPickup : BagOfCoins := <span style='background:lime'>{</span>|-&gt;}; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
productToPickup : [Product] := <span style='background:lime'>nil</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Items observable by maintenance
operator:</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
stockOfCoins: BagOfCoins := <span style='background:lime'>{</span>|-&gt;};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Items observable by factory
operator:</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
maintenanceCode : Password := <span style='background:lime'>[</span>]; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>inv</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>amountInserted</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>0</span> <span style='background:lime'>&lt;=&gt;</span>
<span style='background:lime'>status</span> <span style='background:lime'>=</span>
<span style='background:lime'>&lt;EnteringCoins&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>inv</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>changeToPickup</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>{</span>|-&gt;} <span style='background:lime'>or</span>
<span style='background:lime'>productToPickup</span> <span style='background:
lime'>&lt;&gt;</span> <span style='background:lime'>nil</span> <span
style='background:lime'>&lt;=&gt;</span> <span style='background:lime'>status</span>
<span style='background:lime'>=</span> <span style='background:lime'>&lt;Delivering&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>inv</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>productToPickup</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>nil</span> <span style='background:lime'>=&gt;</span>
<span style='background:lime'>productToPickup</span> <span style='background:
lime'>in</span></span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'> set</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>rng</span> <span
style='background:lime'>products</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>operations</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/** FACTORY OPERATIONS **/</span><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
VendingMachine: () ==&gt; VendingMachine</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=FR style='font-size:
10.0pt;font-family:Consolas;color:black'>VendingMachine() == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>        <span style='background:lime'>return</span> <span
style='background:lime'>self</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>   </span><b><span lang=FR style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>public</span></b><span lang=FR
style='font-size:10.0pt;font-family:Consolas;color:black'> setMaintenanceCode:
Password ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>   setMaintenanceCode(code) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>     <span style='background:lime'>maintenanceCode</span>
:= <span style='background:lime'>code</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=FR style='font-size:10.0pt;font-family:
Consolas;color:black'>   </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>pre</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnFactory&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
setProductsAtSale: </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>map</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> ProductName </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductPrice ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   setProductsAtSale(prods) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>products</span>
:= <span style='background:lime'>{name</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>new</span> <span style='background:lime'>Product</span>(<span
style='background:lime'>name</span>, <span style='background:lime'>prods</span>(<span
style='background:lime'>name</span>)) | name </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>prods</span>}</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnFactory&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> setReady:
() ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   setReady() ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>status</span>
:= <span style='background:lime'>&lt;Idle&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnFactory&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/** MAINTENANCE OPERATIONS **/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> openDoor:
Password ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   openDoor(code) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>code</span> <span style='background:lime'>=</span> <span
style='background:lime'>maintenanceCode</span> </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>        <span style='color:black;background:lime'>status</span><span
style='color:black'> := <span style='background:lime'>&lt;OnMaintenance&gt;</span></span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;Idle&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
loadCoins: BagOfCoins ==&gt; () </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   loadCoins(coins) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>stockOfCoins</span>
:= <span style='background:lime'>coins</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnMaintenance&gt;</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- 'prods' is a mapping from product
name to number of items</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
loadProducts: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>map</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> ProductName </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nat1</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>  ==&gt;
() </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   loadProducts(prods) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>for</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> all</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> nm </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>prods</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>do</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>products</span>(<span
style='background:lime'>nm</span>).addToStock(<span style='background:lime'>prods</span>(<span
style='background:lime'>nm</span>))</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnMaintenance&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>dom</span> <span style='background:lime'>prods</span>
<span style='background:lime'>subset</span> <span style='background:lime'>dom</span>
<span style='background:lime'>products</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
closeDoor: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   closeDoor() ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>status</span>
:= <span style='background:lime'>&lt;Idle&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;OnMaintenance&gt;</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/** BUYER OPERATIONS **/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
insertCoin: MoneyUtils`Coin ==&gt; () </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   insertCoin(coin) == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>atomic</span>
(</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>stockOfCoins</span>
:= <span style='background:lime'>MoneyUtils`add</span>(<span style='background:
lime'>coin</span>, <span style='background:lime'>stockOfCoins</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>amountInserted</span>
:=  <span style='background:lime'>amountInserted</span> <span style='background:
lime'>+</span> <span style='background:lime'>coin</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>status</span>
:= <span style='background:lime'>&lt;EnteringCoins&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{&lt;Idle&gt;</span>, <span style='background:lime'>&lt;EnteringCoins&gt;</span>};
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
selectProduct: ProductName ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   selectProduct(prodName) == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>let</span>
p = <span style='background:lime'>products</span>(<span style='background:lime'>prodName</span>),</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>         chg = <span style='background:lime'>MoneyUtils`extract</span>(<span
style='background:lime'>stockOfCoins</span>, <span style='background:lime'>amountInserted</span>
<span style='background:lime'>-</span> <span style='background:lime'>p</span>.<span
style='background:lime'>price</span>) </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>p</span>.removeFromStock(<span
style='background:lime'>1</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>          <span style='background:lime'>atomic</span>
(</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>stockOfCoins</span>
:= <span style='background:lime'>MoneyUtils`removeAll</span>(<span
style='background:lime'>chg</span>, <span style='background:lime'>stockOfCoins</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>amountInserted</span>
:= <span style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>changeToPickup</span>
:= <span style='background:lime'>chg</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>productToPickup</span>
:= <span style='background:lime'>p</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>status</span>
:= <span style='background:lime'>&lt;Delivering&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>  <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;EnteringCoins&gt;</span>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>prodName</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>products</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>products</span>(<span style='background:lime'>prodName</span>).<span
style='background:lime'>quantityInStock</span> <span style='background:lime'>&gt;</span>
<span style='background:lime'>0</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>amountInserted</span> <span style='background:
lime'>&gt;=</span> <span style='background:lime'>products</span>(<span
style='background:lime'>prodName</span>).<span style='background:lime'>price</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>MoneyUtils`canExtract</span>(<span
style='background:lime'>stockOfCoins</span>, </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                <span style='background:lime'>amountInserted</span>
<span style='background:lime'>-</span> <span style='background:lime'>products</span>(<span
style='background:lime'>prodName</span>).<span style='background:lime'>price</span>);      </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
pickChange: () ==&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   pickChange() ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>let</span>
r = <span style='background:lime'>changeToPickup</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>atomic</span>(
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>changeToPickup</span>
:= <span style='background:lime'>{</span>|-&gt;};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>status</span>
:= <span style='background:lime'>if</span> <span style='background:lime'>productToPickup</span>
<span style='background:lime'>=</span> <span style='background:lime'>nil</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>then</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>&lt;Idle&gt;</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>else</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:red'>&lt;Delivering&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>return</span>
<span style='background:lime'>r</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>changeToPickup</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>{</span>|-&gt;};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
pickProduct: () ==&gt; ProductName</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   pickProduct() == <span style='background:
lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>let</span>
r = <span style='background:lime'>productToPickup</span>.<span
style='background:lime'>name</span> </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>atomic</span>
(</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>productToPickup</span>
:= <span style='background:lime'>nil</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>status</span>
:= <span style='background:lime'>if</span> <span style='background:lime'>changeToPickup</span>
<span style='background:lime'>=</span> <span style='background:lime'>{</span>|-&gt;}
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>then</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>&lt;Idle&gt;</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>else</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>&lt;Delivering&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>return</span>
<span style='background:lime'>r</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>productToPickup</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>nil</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> cancel:
() ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  cancel() ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>let</span>
chg = <span style='background:lime'>MoneyUtils`extract</span>(<span
style='background:lime'>stockOfCoins</span>, <span style='background:lime'>amountInserted</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>atomic</span>
(</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>stockOfCoins</span>
:= <span style='background:lime'>MoneyUtils`removeAll</span>(<span
style='background:lime'>chg</span>, <span style='background:lime'>stockOfCoins</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>amountInserted</span>
:= <span style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>changeToPickup</span>
:= <span style='background:lime'>chg</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>status</span>
:= <span style='background:lime'>&lt;Delivering&gt;</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>status</span> <span style='background:lime'>=</span> <span
style='background:lime'>&lt;EnteringCoins&gt;</span>;  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>end</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> VendingMachine</span><span
lang=EN-US style='font-size:10.0pt'> </span></p>

<h1><a name="_Toc435377808"><span lang=EN-US>4. Model validation</span></a></h1>

<h2><a name="_Toc435377809"><span lang=EN-US>4.1 Class MyTestCase</span></a></h2>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>class</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> MyTestCase</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Superclass for test classes, simpler but
more practical than VDMUnit`TestCase. </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  For proper use, you have to do: New -&gt;
Add VDM Library -&gt; IO.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  JPF, FEUP, MFES, 2014/15.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>operations</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Simulates assertion checking by
reducing it to pre-condition checking.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- If 'arg' does not hold, a
pre-condition violation will be signaled.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>protected</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
assertTrue: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>bool</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   assertTrue(arg) == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:red'>return</span>
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:red'>arg</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Simulates assertion checking by
reducing it to post-condition checking.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- If values are not equal, prints a
message in the console and generates </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- a post-conditions violation.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>protected</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
assertEqual: ? * ? ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   assertEqual(expected, actual) == </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>expected</span> <span style='background:lime'>&lt;&gt;</span>
<span style='background:lime'>actual</span> </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:red'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>IO`print</span>(<span
style='background:red'>&quot;Actual value (&quot;</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>IO`print</span>(<span
style='background:red'>actual</span>); </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>IO`print</span>(<span
style='background:red'>&quot;) different from expected (&quot;</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>IO`print</span>(<span
style='background:red'>expected</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>IO`println</span>(<span
style='background:red'>&quot;)\n&quot;</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>post</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>expected</span> <span style='background:lime'>=</span> <span
style='background:lime'>actual</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>end</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> MyTestCase</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<h2><a name="_Toc435377810"><span lang=EN-US>4.2 Class TestVendingMachine</span></a></h2>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>class</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> TestVendingMachine </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>is
subclass of</span></b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:black'> MyTestCase</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Contains the test cases for the vending
machine.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Illustrates a scenario-based testing
approach.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  The test cases cover all usage scenarios
as well as all states and transitions.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  Also illustrates the usage of assertions
and '||'.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>  JPF, FEUP, MFES, 2014/15.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>operations</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/***** USE CASE SCENARIOS ******/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Normal scenario for configuring
the vending machine in the factory,</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- as described in section 2.1 of
the report, covering requirement R1.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- 'prodsAtSale' is a map from names
to prices.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ConfigureScn: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>map</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> Product`ProductName </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
Product`ProductPrice * VendingMachine`Password ==&gt; VendingMachine</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   ConfigureScn(prodsAtSale, maintenanceCode)
== <span style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> vm :
VendingMachine := <span style='background:lime'>new</span> <span
style='background:lime'>VendingMachine</span>();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>||</span>
( <span style='background:lime'>vm</span>.setProductsAtSale(<span
style='background:lime'>prodsAtSale</span>),</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>          <span style='background:lime'>vm</span>.setMaintenanceCode(<span
style='background:lime'>maintenanceCode</span>));</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>vm</span>.setReady();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>return</span>
<span style='background:lime'>vm</span>;    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>post</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{p</span>.<span style='background:lime'>name</span> <span
style='background:lime'>|-&gt;</span> <span style='background:lime'>p</span>.<span
style='background:lime'>price</span> | p </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>rng</span> <span style='background:lime'>RESULT</span>.<span
style='background:lime'>products</span>} <span style='background:lime'>=</span>
<span style='background:lime'>prodsAtSale</span> </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>RESULT</span>.<span style='background:lime'>maintenanceCode</span>
<span style='background:lime'>=</span> <span style='background:lime'>maintenanceCode</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>RESULT</span>.<span style='background:lime'>stockOfCoins</span>
<span style='background:lime'>=</span> <span style='background:lime'>{</span>|-&gt;}
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>forall</span> p </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>rng</span> <span style='background:lime'>RESULT</span>.<span
style='background:lime'>products</span> &amp; <span style='background:lime'>p</span>.<span
style='background:lime'>quantityInStock</span> <span style='background:lime'>=</span>
<span style='background:lime'>0</span> </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>/*4*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>RESULT</span>.<span style='background:lime'>status</span>
<span style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*5*/</span><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:black'>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Normal scenario for loading
(adding) products and </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- setting (adding/removing) the
stock of coins in a vending machine,</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- as described in section 2.1 of
the report, covering requirement R2.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
LoadStockScn: VendingMachine * VendingMachine`Password * </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>map</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
Product`ProductName </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>to</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> Product`ProductPrice
* MoneyUtils`BagOfCoins ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   LoadStockScn(vm, code, prods, coins) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   <span style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- manual old
values</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
oldQuantityInStock : </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>map</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> Product </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nat</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> := </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                  <span style='background:
lime'>{p</span> <span style='background:lime'>|-&gt;</span> <span
style='background:lime'>p</span>.<span style='background:lime'>quantityInStock</span>
| p </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in set</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:lime'>rng</span> <span
style='background:lime'>vm</span>.<span style='background:lime'>products</span>};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- steps</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>vm</span>.openDoor(<span
style='background:lime'>code</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>||</span>
(<span style='background:lime'>vm</span>.loadProducts(<span style='background:
lime'>prods</span>), <span style='background:lime'>vm</span>.loadCoins(<span
style='background:lime'>coins</span>));           </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>vm</span>.closeDoor();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- manual
post-condition checking (not supported otherwise)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>assertTrue</span>(<span
style='background:lime'>forall</span> prodName </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>prods</span>
&amp; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                  <span style='background:
lime'>let</span> p = <span style='background:lime'>vm</span>.<span
style='background:lime'>products</span>(<span style='background:lime'>prodName</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                     <span style='background:
lime'>p</span>.<span style='background:lime'>quantityInStock</span> <span
style='background:lime'>=</span> <span style='background:lime'>oldQuantityInStock</span>(<span
style='background:lime'>p</span>) <span style='background:lime'>+</span> <span
style='background:lime'>prods</span>(<span style='background:lime'>prodName</span>))
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>vm</span>.<span style='background:lime'>status</span> <span
style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>and</span>
<span style='background:lime'>code</span> <span style='background:lime'>=</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>maintenanceCode</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>and</span>
<span style='background:lime'>dom</span> <span style='background:lime'>prods</span>
<span style='background:lime'>subset</span> <span style='background:lime'>dom</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>products</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>post</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>vm</span>.<span style='background:lime'>stockOfCoins</span>
<span style='background:lime'>=</span> <span style='background:lime'>coins</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>       <span style='background:lime'>and</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>status</span>
<span style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>;
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>         </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Normal purchase scenario in a
vending machine, </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- as described in section 2.1 of
the report, covering requirements R3 and R4.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
BuyProductScn: VendingMachine * Product`ProductName * MoneyUtils`BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                            ==&gt;
[Product`ProductName] * MoneyUtils`BagOfCoins</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   BuyProductScn(vm, prod, coins) == <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- manual old
values</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
oldQuantityInStock : </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nat</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> := <span
style='background:lime'>vm</span>.<span style='background:lime'>products</span>(<span
style='background:lime'>prod</span>).<span style='background:lime'>quantityInStock</span>;
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
oldStockOfCoins : MoneyUtils`BagOfCoins := <span style='background:lime'>vm</span>.<span
style='background:lime'>stockOfCoins</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- steps</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> inserted
: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> := <span style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
deliveredProd : [</span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>seq</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>of</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>char</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>] := <span
style='background:lime'>nil</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> change :
MoneyUtils`BagOfCoins := <span style='background:lime'>{</span>|-&gt;};</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> result :
[Product`ProductName] * MoneyUtils`BagOfCoins;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>for</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> all</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> c </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>coins</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>do</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>for</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> all</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> - </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{1</span> , ..., <span style='background:lime'>coins</span>(<span
style='background:lime'>c</span>)} </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>do</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>vm</span>.insertCoin(<span
style='background:lime'>c</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>inserted</span>
:= <span style='background:lime'>inserted</span> <span style='background:lime'>+</span>
<span style='background:lime'>c</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>assertEqual</span>(<span
style='background:lime'>inserted</span>, <span style='background:lime'>vm</span>.<span
style='background:lime'>amountInserted</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      );            </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>vm</span>.selectProduct(<span
style='background:lime'>prod</span>);    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>||</span>
(<span style='background:lime'>deliveredProd</span> := <span style='background:
lime'>vm</span>.<span style='background:lime'>pickProduct</span>(), </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>if</span> <span
style='background:lime'>MoneyUtils`sum</span>(<span style='background:lime'>coins</span>)
<span style='background:lime'>&gt;</span> <span style='background:lime'>vm</span>.<span
style='background:lime'>products</span>(<span style='background:lime'>prod</span>).<span
style='background:lime'>price</span> </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>change</span>
:= <span style='background:lime'>vm</span>.<span style='background:lime'>pickChange</span>());</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>result</span>
:= <span style='background:lime'>mk_</span>(<span style='background:lime'>deliveredProd</span>,
<span style='background:lime'>change</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- manual
post-condition checking (not supported otherwise)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>assertTrue</span>(<span
style='background:lime'>vm</span>.<span style='background:lime'>products</span>(<span
style='background:lime'>prod</span>).<span style='background:lime'>quantityInStock</span>
<span style='background:lime'>=</span> <span style='background:lime'>oldQuantityInStock</span>
<span style='background:lime'>-</span> <span style='background:lime'>1</span>);
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>assertTrue</span>(<span
style='background:lime'>MoneyUtils`addAll</span>(<span style='background:lime'>vm</span>.<span
style='background:lime'>stockOfCoins</span>, <span style='background:lime'>change</span>)
<span style='background:lime'>=</span> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                           <span
style='background:lime'>MoneyUtils`addAll</span>(<span style='background:lime'>oldStockOfCoins</span>,
<span style='background:lime'>coins</span>)); </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>/* 4*/</span><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                           </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>    <span style='background:lime'>return</span>
<span style='background:lime'>result</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>vm</span>.<span style='background:lime'>status</span> <span
style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>and</span>
(<span style='background:lime'>prod</span> <span style='background:lime'>in</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>vm</span>.<span
style='background:lime'>products</span> <span style='background:lime'>and</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>products</span>(<span
style='background:lime'>prod</span>).<span style='background:lime'>quantityInStock</span>
<span style='background:lime'>&gt;</span> <span style='background:lime'>0</span>)
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>       <span style='background:lime'>and</span>
<span style='background:lime'>MoneyUtils`sum</span>(<span style='background:
lime'>coins</span>) <span style='background:lime'>&gt;=</span> <span
style='background:lime'>vm</span>.<span style='background:lime'>products</span>(<span
style='background:lime'>prod</span>).<span style='background:lime'>price</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>       <span style='background:lime'>and</span>
<span style='background:lime'>MoneyUtils`canExtract</span>(<span
style='background:lime'>MoneyUtils`addAll</span>(<span style='background:lime'>vm</span>.<span
style='background:lime'>stockOfCoins</span>, <span style='background:lime'>coins</span>),
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                        <span
style='background:lime'>MoneyUtils`sum</span>(<span style='background:lime'>coins</span>)
<span style='background:lime'>-</span> <span style='background:lime'>vm</span>.<span
style='background:lime'>products</span>(<span style='background:lime'>prod</span>).<span
style='background:lime'>price</span>) </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/*4*/</span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'>         </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>post</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>let</span> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>mk_</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'>(deliveredProd,
change) = <span style='background:lime'>RESULT</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> (</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>          <span style='background:lime'>deliveredProd</span>
<span style='background:lime'>=</span> <span style='background:lime'>prod</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>          <span style='background:lime'>and</span>
<span style='background:lime'>MoneyUtils`sum</span>(<span style='background:
lime'>change</span>)<span style='background:lime'>=MoneyUtils`sum</span>(<span
style='background:lime'>coins</span>)<span style='background:lime'>-vm</span>.<span
style='background:lime'>products</span>(<span style='background:lime'>prod</span>).<span
style='background:lime'>price</span></span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>          <span style='background:lime'>and</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>status</span>
<span style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*5*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Exceptional buying scenario in
which the user cancels the purchase.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- as described in section 2.1 of
the report, covering requirement R5.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
CancelScn: VendingMachine * MoneyUtils`BagOfCoins ==&gt; MoneyUtils`BagOfCoins</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   CancelScn(vm, coins) == <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- 'manual' old
value</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
oldStockOfCoins : MoneyUtils`BagOfCoins := <span style='background:lime'>vm</span>.<span
style='background:lime'>stockOfCoins</span>; </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- steps</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> inserted
: </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>nat</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> := <span style='background:lime'>0</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> result :
MoneyUtils`BagOfCoins;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>for</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> all</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> c </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>dom</span> <span style='background:lime'>coins</span> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>do</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>for</span></span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'> all</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> - </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>{1</span> , ..., <span style='background:lime'>coins</span>(<span
style='background:lime'>c</span>)} </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>do</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>vm</span>.insertCoin(<span
style='background:lime'>c</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>inserted</span>
:= <span style='background:lime'>inserted</span> <span style='background:lime'>+</span>
<span style='background:lime'>c</span>;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <span style='background:lime'>assertEqual</span>(<span
style='background:lime'>inserted</span>, <span style='background:lime'>vm</span>.<span
style='background:lime'>amountInserted</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     );             </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>vm</span>.cancel();   
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>result</span>
:= <span style='background:lime'>vm</span>.<span style='background:lime'>pickChange</span>();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- 'manual'
post-condition checking (not supported otherwise)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>assertTrue</span>(<span
style='background:lime'>MoneyUtils`addAll</span>(<span style='background:lime'>oldStockOfCoins</span>,
<span style='background:lime'>coins</span>) <span style='background:lime'>=</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                 <span style='background:
lime'>MoneyUtils`addAll</span>(<span style='background:lime'>vm</span>.<span
style='background:lime'>stockOfCoins</span>, <span style='background:lime'>result</span>));
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*2*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>                 </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>return</span>
<span style='background:lime'>result</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>  <span
style='background:lime'>vm</span>.<span style='background:lime'>status</span> <span
style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>MoneyUtils`sum</span>(<span style='background:
lime'>coins</span>) <span style='background:lime'>&gt;</span> <span
style='background:lime'>0</span> </span><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>/*2*/</span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>post</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>MoneyUtils`sum</span>(<span style='background:lime'>RESULT</span>)
<span style='background:lime'>=</span> <span style='background:lime'>MoneyUtils`sum</span>(<span
style='background:lime'>coins</span>) </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/*1*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>and</span>
<span style='background:lime'>vm</span>.<span style='background:lime'>status</span>
<span style='background:lime'>=</span> <span style='background:lime'>&lt;Idle&gt;</span>;
</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#3F7F5F'>/*3*/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/***** TEST CASES WITH VALID INPUTS
******/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>         </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Test case in which we initialize
a vending machine and</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- then buy two products, the first
one with exact money and </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- the second one with change.        
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testLoadAndBuy: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testLoadAndBuy() == <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dcl</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> vm:
VendingMachine := <span style='background:lime'>ConfigureScn</span>({<span
style='background:lime'>&quot;Bolicao&quot;</span> <span style='background:
lime'>|-&gt;</span> <span style='background:lime'>50</span>, <span
style='background:lime'>&quot;Bongo&quot;</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>70</span>}, <span style='background:lime'>&quot;xa1!&quot;</span>);
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>LoadStockScn</span>(<span
style='background:lime'>vm</span>, <span style='background:lime'>&quot;xa1!&quot;</span>,
{<span style='background:lime'>&quot;Bolicao&quot;</span> <span
style='background:lime'>|-&gt;</span> <span style='background:lime'>1</span>, <span
style='background:lime'>&quot;Bongo&quot;</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>1</span>}, <span style='background:lime'>{</span>
|-&gt; });    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>let</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>mk_</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>(-, change) = <span style='background:lime'>BuyProductScn</span>(<span
style='background:lime'>vm</span>, <span style='background:lime'>&quot;Bolicao&quot;</span>,
{<span style='background:lime'>20</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>1</span>, <span style='background:lime'>10</span>
<span style='background:lime'>|-&gt;</span> <span style='background:lime'>3</span>})
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>assertEqual</span>(<span
style='background:lime'>{</span> |-&gt; }, <span style='background:lime'>change</span>);   
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>let</span>
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>mk_</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>(-, change) = <span style='background:lime'>BuyProductScn</span>(<span
style='background:lime'>vm</span>, <span style='background:lime'>&quot;Bongo&quot;</span>,
{<span style='background:lime'>20</span> <span style='background:lime'>|-&gt;</span>
<span style='background:lime'>4</span>}) </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:lime'>assertEqual</span>({<span
style='background:lime'>10</span> <span style='background:lime'>|-&gt;</span> <span
style='background:lime'>1</span>}, <span style='background:lime'>change</span>)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Test case in which we initialize
a vending machine an then enter coins and cancel.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#3F7F5F'>   -- Also forces backtracking in the
greedy algorithm for making change.       </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testLoadAndCancel: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testLoadAndCancel() == <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:lime'>let</span>
vm = <span style='background:lime'>ConfigureScn</span>({<span style='background:
lime'>&quot;Bolicao&quot;</span> <span style='background:lime'>|-&gt;</span> <span
style='background:lime'>50</span>}, <span style='background:lime'>&quot;xa1!&quot;</span>),</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>         coins = {<span style='background:
lime'>20</span> <span style='background:lime'>|-&gt;</span> <span
style='background:lime'>3</span>}</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> <span
style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>       <span style='background:lime'>LoadStockScn</span>(<span
style='background:lime'>vm</span>, <span style='background:lime'>&quot;xa1!&quot;</span>,
{<span style='background:lime'>&quot;Bolicao&quot;</span> <span
style='background:lime'>|-&gt;</span> <span style='background:lime'>1</span>}, <span
style='background:lime'>{</span> <span style='background:lime'>50</span> <span
style='background:lime'>|-&gt;</span> <span style='background:lime'>1</span>}); 
     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>       <span style='background:lime'>assertEqual</span>(<span
style='background:lime'>coins</span>,  <span style='background:lime'>CancelScn</span>(<span
style='background:lime'>vm</span>, <span style='background:lime'>coins</span>))</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- Entry point that runs all tests
with valid inputs</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> testAll:
() ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  testAll() == <span style='background:lime'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>testLoadAndBuy</span>();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:lime'>testLoadAndCancel</span>();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>/***** TEST CASES WITH INVALID
INPUTS (EXECUTE ONE AT A TIME) ******/</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testCannotMakeChange: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testCannotMakeChange() == <span
style='background:red'>(</span>      </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:red'>let</span>
vm = <span style='background:red'>ConfigureScn</span>({<span style='background:
red'>&quot;Bolicao&quot;</span> <span style='background:red'>|-&gt;</span> <span
style='background:red'>50</span>}, <span style='background:red'>&quot;xa1!&quot;</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:red'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>LoadStockScn</span>(<span
style='background:red'>vm</span>, <span style='background:red'>&quot;xa1!&quot;</span>,
{<span style='background:red'>&quot;Bolicao&quot;</span> <span
style='background:red'>|-&gt;</span> <span style='background:red'>1</span>}, <span
style='background:red'>{</span> |-&gt; });    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>100</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.selectProduct(<span
style='background:red'>&quot;Bolicao&quot;</span>); </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- breaks
pre-condition</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testProductOutOfStock: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testProductOutOfStock() == <span
style='background:red'>(</span>     </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>      <span style='background:red'>let</span>
vm = <span style='background:red'>ConfigureScn</span>({<span style='background:
red'>&quot;Bolicao&quot;</span> <span style='background:red'>|-&gt;</span> <span
style='background:red'>50</span>}, <span style='background:red'>&quot;xa1!&quot;</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:red'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>50</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.selectProduct(<span
style='background:red'>&quot;Bolicao&quot;</span>); </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- breaks
pre-condition</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testForgotToPickProduct: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testForgotToPickProduct() == <span
style='background:red'>(</span>         </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   <span style='background:red'>let</span> vm
= <span style='background:red'>ConfigureScn</span>({<span style='background:
red'>&quot;Bolicao&quot;</span> <span style='background:red'>|-&gt;</span> <span
style='background:red'>50</span>}, <span style='background:red'>&quot;xa1!&quot;</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:red'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:red'>LoadStockScn</span>(<span
style='background:red'>vm</span>, <span style='background:red'>&quot;xa1!&quot;</span>,
{<span style='background:red'>&quot;Bolicao&quot;</span> <span
style='background:red'>|-&gt;</span> <span style='background:red'>1</span>}, <span
style='background:red'>{</span> |-&gt; });       </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>50</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.selectProduct(<span
style='background:red'>&quot;Bolicao&quot;</span>); </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- forgot:
vm.pickProduct();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>50</span>); </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- breaks pre-condition</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
testForgotToPickChange: () ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   testForgotToPickChange() == <span
style='background:red'>(</span>          </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     <span style='background:red'>let</span>
vm = <span style='background:red'>ConfigureScn</span>({<span style='background:
red'>&quot;Bolicao&quot;</span> <span style='background:red'>|-&gt;</span> <span
style='background:red'>50</span>}, <span style='background:red'>&quot;xa1!&quot;</span>)
</span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> <span style='background:red'>(</span></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>LoadStockScn</span>(<span
style='background:red'>vm</span>, <span style='background:red'>&quot;xa1!&quot;</span>,
{<span style='background:red'>&quot;Bolicao&quot;</span> <span
style='background:red'>|-&gt;</span> <span style='background:red'>1</span>}, <span
style='background:red'>{</span> |-&gt; });    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>50</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.cancel();
</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#3F7F5F'>-- forgot:
vm.pickChange();</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        <span style='background:red'>vm</span>.insertCoin(<span
style='background:red'>50</span>); </span><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#3F7F5F'>-- breaks pre-condition</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   );    </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>  </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>end</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> TestVendingMachine</span><span
lang=EN-US style='font-size:10.0pt'> </span></p>

<h1><a name="_Toc435377811"><span lang=EN-US>5. Model verification</span></a></h1>

<h2><a name="_Toc435377812"><span lang=EN-US>5.1 Example of domain verification</span></a></h2>

<p class=MsoNormal style='margin-bottom:12.0pt'><span lang=EN-US
style='font-size:10.0pt;line-height:115%;font-family:Consolas;color:black'>One
of the proof obligations generated by Overture is:</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=45 valign=top style='width:33.75pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>No.</span></p>
  </td>
  <td width=274 valign=top style='width:205.55pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>PO Name</span></p>
  </td>
  <td width=340 valign=top style='width:255.3pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>Type</span></p>
  </td>
 </tr>
 <tr>
  <td width=45 valign=top style='width:33.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>61</span></p>
  </td>
  <td width=274 valign=top style='width:205.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>VendingMachine`setProductsAtSale</span></p>
  </td>
  <td width=340 valign=top style='width:255.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>legal map application</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:6.0pt'><span lang=EN-US>The code under
analysis (with the relevant map application underlined) is:</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
setProductsAtSale: </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>map</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> ProductName </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>to</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
ProductPrice ==&gt; ()</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   setProductsAtSale(prods) ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     products := { name |-&gt; </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>new</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
Product(name, <u>prods(name)</u>) | <b>name </b></span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dom</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> prods</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>};</span></p>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
12.0pt;margin-left:0cm;text-align:justify;line-height:normal;text-autospace:
none'><span lang=EN-US>In this case the proof is trivial because the
quantification '</span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:black'>name </span></b><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>in set</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>dom</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> prods'</span></b><span
lang=EN-US> assures that the map is accesses only inside its domain.</span></p>

<h2><a name="_Toc435377813"><span lang=EN-US>5.2 Example of invariant verification</span></a><span
lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;line-height:115%;
font-family:Consolas;color:black'>Another proof obligation generated by
Overture is:</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=45 valign=top style='width:33.75pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>No.</span></p>
  </td>
  <td width=274 valign=top style='width:205.55pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>PO Name</span></p>
  </td>
  <td width=340 valign=top style='width:255.3pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>Type</span></p>
  </td>
 </tr>
 <tr>
  <td width=45 valign=top style='width:33.75pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>73</span></p>
  </td>
  <td width=274 valign=top style='width:205.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>VendingMachine`pickChange</span></p>
  </td>
  <td width=340 valign=top style='width:255.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
  color:black'>state invariant holds</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
12.0pt;margin-left:0cm'><span lang=EN-US>The code under analysis (with the relevant
state changes underlined) is:</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>public</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
pickChange: () ==&gt; BagOfCoins </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   pickChange() ==</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>let</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> r =
changeToPickup </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:#7F0055'>in</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> (</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>atomic</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>( </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <u>changeToPickup := {|-&gt;};</u></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>           <u>status := </u></span><b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>if</span></u></b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
productToPickup = </span></u><b><u><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nil</span></u></b><u><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span></u><b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></u></b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></u><b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Idle&gt;</span></u></b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></u><b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></u></b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span></u><b><u><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;</span></u></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        );</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>        </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>return</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> r</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>     )</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>pre</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
changeToPickup </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:navy'>&lt;&gt;</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> {|-&gt;};</span></p>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
12.0pt;margin-left:0cm;line-height:normal;text-autospace:none'><span
lang=EN-US>The relevant invariant under analysis is:</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>   </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>inv</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
changeToPickup </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:navy'>&lt;&gt;</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> {|-&gt;} </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>or</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
productToPickup </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:navy'>&lt;&gt;</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>nil</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> &lt;=&gt; status = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>;</span></p>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
12.0pt;margin-left:0cm;text-align:justify;line-height:normal;text-autospace:
none'><span lang=EN-US>After the execution of the '</span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>atomic</span></b><span
lang=EN-US>' block we have (technically, this is the post-condition of the block):</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>changeToPickup
= {|-&gt;}</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas'>
<b><span style='color:#7F0055'>and</span></b><span style='color:black'> (status
= </span><b><span style='color:#7F0055'>if</span></b><span style='color:black'>
productToPickup = </span><b><span style='color:#7F0055'>nil</span></b><span
style='color:black'> </span><b><span style='color:#7F0055'>then</span></b><span
style='color:black'> </span><b><span style='color:navy'>&lt;Idle&gt;</span></b><span
style='color:black'> </span><b><span style='color:#7F0055'>else</span></b><span
style='color:black'> </span><b><span style='color:navy'>&lt;Delivering&gt;)</span></b></span></p>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
12.0pt;margin-left:0cm;text-align:justify;line-height:normal;text-autospace:
none'><span lang=EN-US>We have to prove that this implies that the invariant
holds, i.e., that the following condition holds:</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>(changeToPickup
= {|-&gt;}</span><span lang=EN-US style='font-size:10.0pt;font-family:Consolas'>
<b><span style='color:#7F0055'>and</span></b><span style='color:black'> (status
= </span><b><span style='color:#7F0055'>if</span></b><span style='color:black'>
productToPickup = </span><b><span style='color:#7F0055'>nil</span></b><span
style='color:black'> </span><b><span style='color:#7F0055'>then</span></b><span
style='color:black'> </span><b><span style='color:navy'>&lt;Idle&gt;</span></b><span
style='color:black'> </span><b><span style='color:#7F0055'>else</span></b><span
style='color:black'> </span><b><span style='color:navy'>&lt;Delivering&gt;))  =&gt; 
</span></b></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:navy'>(</span></b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:black'>changeToPickup </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> {|-&gt;} </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>or</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
productToPickup </span><b><span lang=EN-US style='font-size:10.0pt;font-family:
Consolas;color:navy'>&lt;&gt;</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> </span><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas;color:#7F0055'>nil</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> &lt;=&gt; status = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas'>)</span></b></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0cm;margin-bottom:6.0pt;
margin-left:0cm;text-align:justify;line-height:normal;text-autospace:none'><span
lang=EN-US>This formally implies that:</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>(status
= </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:#7F0055'>if</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'> productToPickup = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nil</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Idle&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;)
 </span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:navy'>=&gt; (</span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>productToPickup </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nil</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> &lt;=&gt;
status = </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:navy'>&lt;Delivering&gt;</span></b><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas'>)</span></b></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0cm;margin-bottom:6.0pt;
margin-left:0cm;text-align:justify;line-height:normal;text-autospace:none'><span
lang=EN-US>which can be rewritten as:</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>(</span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>if</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'>
productToPickup = </span><b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:#7F0055'>nil</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> status = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Idle&gt;</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>else</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> status = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;)
</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:14.2pt;margin-bottom:.0001pt;line-height:normal;text-autospace:
none'><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:navy'>=&gt; (if </span></b><span lang=EN-US style='font-size:10.0pt;
font-family:Consolas;color:black'>productToPickup </span><b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas'>=</span></b><span lang=EN-US
style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>nil</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:#7F0055'>then</span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> status
&lt;&gt; </span><b><span lang=EN-US style='font-size:10.0pt;font-family:Consolas;
color:navy'>&lt;Delivering&gt;</span></b><b><span lang=EN-US style='font-size:
10.0pt;font-family:Consolas'>) <span style='color:#7F0055'>else</span></span></b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:black'> status = </span><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas;color:navy'>&lt;Delivering&gt;</span></b><b><span
lang=EN-US style='font-size:10.0pt;font-family:Consolas'>)</span></b></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0cm;margin-bottom:6.0pt;
margin-left:0cm;text-align:justify;line-height:normal;text-autospace:none'><span
lang=EN-US>which is obviously true.</span></p>

<h1><a name="_Toc435377814"><span lang=EN-US>6. Conclusions</span></a></h1>

<p class=MsoNormal style='margin-top:12.0pt;text-align:justify'><span
lang=EN-US>The model that was developed covers all the requirements.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-US>If space permitted,
as future work, it would be useful to also specify and test the behavior in
exceptional conditions.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-US>This project
took approximately 16 hours to develop.</span></p>

<h1><a name="_Toc435377815">7. References</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoListParagraphCxSpFirst style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Validated Designs for Object-oriented Systems,
J. Fitzgerald, P.G.&nbsp;Larsen, P. Mukherjee, N. Plat, M.&nbsp;Verhoef,
Springer, 2005</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:18.0pt;text-indent:-18.0pt'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>VDM-10 Language Manual, Peter Gorm Larsen et al, Overture Technical
Report Series No. </span>TR-001, March 2014</p>

<p class=MsoListParagraphCxSpLast style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Overture tool web site, http://overturetool.org </span></p>

</div>

<div><br clear=all>

<hr align=left size=1 width="33%">

<div id=ftn1>

<p class=MsoFootnoteText><a href="#_ftnref1" name="_ftn1" title=""><span
class=MsoFootnoteReference><span class=MsoFootnoteReference><span
style='font-size:10.0pt;line-height:115%;font-family:"Calibri",sans-serif'>[1]</span></span></span></a>
<b><span lang=EN-US>Tip</span></b><span lang=EN-US>: Diagrams can be modeled
with Modelio 3.2 to take advantage of the integration with Overture.</span></p>

</div>

<div id=ftn2>

<p class=MsoFootnoteText><a href="#_ftnref2" name="_ftn2" title=""><span
class=MsoFootnoteReference><span class=MsoFootnoteReference><span
style='font-size:10.0pt;line-height:115%;font-family:"Calibri",sans-serif'>[2]</span></span></span></a>
<b><span lang=EN-US>Tip</span></b><span lang=EN-US>: Coarse grained use cases,
representing user goals, were decomposed into fine grained use cases,
corresponding to simpler user interactions (to be modeled as operations). </span></p>

</div>

<div id=ftn3>

<p class=MsoFootnoteText><a href="#_ftnref3" name="_ftn3" title=""><span
class=MsoFootnoteReference><span class=MsoFootnoteReference><span
style='font-size:10.0pt;line-height:115%;font-family:"Calibri",sans-serif'>[3]</span></span></span></a>
<b><span lang=EN-US>Tip</span></b><span lang=EN-US>: Typically, you may have three
kinds of classes, for modeling (i) data types , (i) the system itself and (iii)
test cases.</span></p>

</div>

<div id=ftn4>

<p class=MsoFootnoteText><a href="#_ftnref4" name="_ftn4" title=""><span
class=MsoFootnoteReference><span class=MsoFootnoteReference><span
style='font-size:10.0pt;line-height:115%;font-family:"Calibri",sans-serif'>[4]</span></span></span></a>
<b><span lang=EN-US>Tip:</span></b><span lang=EN-US> It is more practical to
create the class diagrams in the end of the project, using the export/import
features of Overture and Modelio. In the begin of the project, you can simply
sketch the class structure on paper to organize ideas.</span></p>

</div>

<div id=ftn5>

<p class=MsoFootnoteText><a href="#_ftnref5" name="_ftn5" title=""><span
class=MsoFootnoteReference><span class=MsoFootnoteReference><span
style='font-size:10.0pt;line-height:115%;font-family:"Calibri",sans-serif'>[5]</span></span></span></a>
<b><span lang=EN-US>Tip</span></b><span lang=EN-US>: Copy/paste the source code
from the files generated by Overture with coverage information.</span></p>

</div>

</div>

</body>

</html>
